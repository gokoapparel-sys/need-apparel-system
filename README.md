# 📦 アパレル商品管理システム

アパレル企業向けの商品・サンプル管理システム。アイテム、生地、型紙の一元管理から展示会カタログ出力、サンプル貸出管理まで対応。

## 🎯 システム概要

### 主な機能
- **アイテム管理**: 商品情報の登録・編集・検索、型紙との紐付け
- **画像アップロード**: Firebase Storage への画像アップロードと一覧管理
- **生地マスタ**: 生地情報の一元管理とアイテムへの自動連携
- **型紙マスタ**: 型紙・仕様書・展開図・型紙データファイル（CAD）の管理とアイテムとの紐付け
- **展示会カタログ**: PDF形式での自動生成（A4横向き）
- **サンプル貸出管理**: 貸出・返却のシンプルな管理
- **お客様ピックアップ**: 展示会での商品選定とWeb共有
- **コスト管理**: $原価による利益率管理（管理者用）
- **データ連携**: CSV/Excel インポート・エクスポート

### 対象ユーザー
- アパレル企画・営業担当者
- 展示会運営スタッフ
- 生地・型紙管理担当者
- 経営層（コスト分析）

## 🛠️ 技術スタック

### フロントエンド
- **Framework**: React 18.x + TypeScript
- **Build Tool**: Vite
- **Styling**: Tailwind CSS
- **State Management**: React Context API + Custom Hooks
- **Routing**: React Router v6
- **PDF Generation**: @react-pdf/renderer, jsPDF
- **CSV/Excel**: papaparse, xlsx

### バックエンド
- **Database**: Cloud Firestore
- **Storage**: Firebase Storage
- **Authentication**: Firebase Authentication
- **Hosting**: Firebase Hosting
- **Functions**: Cloud Functions for Firebase (オプション)

### 開発ツール
- **Package Manager**: npm / yarn
- **Version Control**: Git
- **Code Quality**: ESLint, Prettier
- **Testing**: Vitest (推奨)

## 📁 プロジェクト構造

```
apparel-management-system/
├── public/                     # 静的ファイル
├── src/
│   ├── components/            # UIコンポーネント
│   │   ├── common/           # 共通コンポーネント
│   │   ├── layout/           # レイアウト
│   │   ├── items/            # アイテム関連
│   │   ├── fabrics/          # 生地関連
│   │   ├── patterns/         # 型紙関連
│   │   ├── exhibitions/      # 展示会関連
│   │   ├── loans/            # 貸出管理
│   │   ├── pickups/          # ピックアップ
│   │   └── pdf/              # PDF出力
│   ├── pages/                # ページコンポーネント
│   ├── hooks/                # カスタムフック
│   ├── services/             # ビジネスロジック
│   │   ├── firebase/         # Firebase操作
│   │   ├── items/            # アイテムサービス
│   │   ├── fabrics/          # 生地サービス
│   │   ├── patterns/         # 型紙サービス
│   │   ├── pdf/              # PDF生成
│   │   └── import-export/    # データ連携
│   ├── utils/                # ユーティリティ
│   ├── types/                # TypeScript型定義
│   ├── contexts/             # Reactコンテキスト
│   └── styles/               # スタイル
├── functions/                # Cloud Functions (オプション)
├── firestore.rules           # Firestoreセキュリティルール
├── storage.rules             # Storageセキュリティルール
├── firebase.json             # Firebase設定
└── DESIGN.md                 # 詳細設計書
```

## 🚀 セットアップ手順

### 前提条件
- Node.js 18.x 以上
- npm または yarn
- Firebase プロジェクト

### 1. リポジトリのクローン
```bash
git clone https://github.com/your-org/apparel-management-system.git
cd apparel-management-system
```

### 2. 依存関係のインストール
```bash
npm install
```

### 3. Firebase プロジェクトの設定

#### Firebaseプロジェクトの作成
1. [Firebase Console](https://console.firebase.google.com/) でプロジェクト作成
2. Authentication を有効化（メール/パスワード認証）
3. Firestore Database を作成（本番モードで開始）
4. Storage を有効化

#### 環境変数の設定
`.env.local` ファイルを作成:
```bash
cp .env.example .env.local
```

以下の環境変数を設定:
```env
VITE_FIREBASE_API_KEY=your_api_key
VITE_FIREBASE_AUTH_DOMAIN=your_project.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=your_project_id
VITE_FIREBASE_STORAGE_BUCKET=your_project.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=123456789
VITE_FIREBASE_APP_ID=your_app_id
```

### 4. Firebaseの初期化
```bash
# Firebase CLIのインストール
npm install -g firebase-tools

# Firebaseにログイン
firebase login

# プロジェクトの初期化
firebase init
```

以下を選択:
- Firestore
- Storage
- Hosting

### 5. セキュリティルールのデプロイ
```bash
firebase deploy --only firestore:rules
firebase deploy --only storage:rules
```

### 6. 開発サーバーの起動
```bash
npm run dev
```

ブラウザで `http://localhost:5173` を開く

### 7. 画像アップロード機能のテスト

#### 前提条件
- Firebase Storage のセキュリティルールが `request.auth != null` で設定済み
- `.env.local` に `VITE_FIREBASE_STORAGE_BUCKET` が正しく設定されている
- Firebase Billing が Blaze プランに切り替わっている

#### テスト手順
1. **ログイン**
   ```bash
   npm run dev
   ```
   - ブラウザで `http://localhost:5173` を開く
   - メール/パスワードでログイン

2. **アップロードページへ移動**
   - ダッシュボードの「画像アップロード」カードをクリック
   - または直接 `http://localhost:5173/uploads` へアクセス

3. **画像をアップロード**
   - 「画像ファイルを選択」ボタンをクリック
   - 画像ファイル（JPEG, PNG, GIF, WebP）を選択（最大10MB）
   - プレビューが表示されることを確認
   - 「アップロード」ボタンをクリック

4. **Firebase での確認**
   - **Storage**: Firebase Console → Storage → `uploads/` フォルダに画像が保存されていることを確認
   - **Firestore**: Firebase Console → Firestore → `uploads` コレクションにメタデータが保存されていることを確認
     ```json
     {
       "url": "https://...",
       "path": "uploads/uuid-filename.jpg",
       "contentType": "image/jpeg",
       "size": 123456,
       "createdAt": "Timestamp",
       "createdBy": "user@example.com"
     }
     ```

5. **一覧表示の確認**
   - アップロード後、同ページ下部にアップロード済み画像一覧が表示される
   - 画像のサムネイル、ファイル情報、アップロード日時が表示される
   - 「画像を開く」リンクで画像が新しいタブで開けることを確認

#### エラーハンドリングのテスト
- **未ログイン**: `/uploads` へアクセスするとログインページへリダイレクト
- **無効なファイル形式**: PDFやテキストファイルを選択すると警告が表示される
- **大きすぎるファイル**: 10MB以上のファイルを選択すると警告が表示される
- **Storage権限エラー**: 認証なしでアップロードすると権限エラーが表示される

### 8. アイテム管理機能のテスト

#### 前提条件
- Firebase Firestore の `items` コレクションが作成可能
- Firebase Storage のセキュリティルールが `request.auth != null` で設定済み
- ログイン済みのユーザーアカウント

#### テスト手順

**1. アイテム一覧の表示**
1. ダッシュボードの「アイテム管理」カードをクリック
2. `/items` ページが表示されることを確認
3. 初回は「アイテムがありません」と表示される
4. 「最初のアイテムを作成」または右上の「+ 新規作成」ボタンをクリック

**2. 新規アイテムの作成**
1. `/items/new` ページが表示される
2. フォームに入力:
   - 名前: 「テストTシャツ」（必須）
   - SKU: 「TS-001」（必須）
   - 色: 「白」
   - サイズ: 「M」
   - 価格: 「3000」（必須、数値）
   - ステータス: 「有効」
3. 画像を追加（複数選択可能）
4. プレビューが表示されることを確認
5. 「作成」ボタンをクリック
6. 「アイテムを作成しました」のアラートが表示される
7. 一覧ページにリダイレクトされ、作成したアイテムが表示される

**3. Firebase での確認**
- **Firestore**: Firebase Console → Firestore → `items` コレクション
  ```json
  {
    "name": "テストTシャツ",
    "sku": "TS-001",
    "color": "白",
    "size": "M",
    "price": 3000,
    "status": "active",
    "images": [
      {
        "url": "https://...",
        "path": "items/{itemId}/{uuid}-filename.jpg"
      }
    ],
    "createdAt": "Timestamp",
    "updatedAt": "Timestamp",
    "createdBy": "user@example.com"
  }
  ```
- **Storage**: Firebase Console → Storage → `items/{itemId}/` フォルダに画像が保存されている

**4. アイテムの編集**
1. 一覧からアイテムの行をクリック
2. 編集ページ `/items/{id}` が表示される
3. フォームの内容を変更:
   - 価格を「3500」に変更
   - 新しい画像を追加
4. 既存の画像を削除（画像にホバーして × ボタンをクリック）
5. 「更新」ボタンをクリック
6. 「アイテムを更新しました」のアラートが表示される
7. 一覧に戻り、変更が反映されていることを確認

**5. アイテムの詳細表示**
1. ブラウザで `/items/{id}/detail` へ直接アクセス
2. 画像ギャラリーと基本情報が表示される
3. 画像をクリックすると新しいタブで開く
4. 「編集」ボタンで編集ページへ遷移できる

**6. 検索とソート**
1. 一覧ページで検索ボックスに「Tシャツ」と入力
2. 「検索」ボタンをクリック
3. 該当アイテムのみ表示される
4. ソートを「古い順」に変更
5. 一覧の並び順が変わることを確認

**7. ページネーション**
1. 21件以上のアイテムを作成（テストデータ）
2. 一覧ページで 20件ずつ表示される
3. 「次のページ →」ボタンが有効になる
4. クリックして次のページへ移動
5. 「← 前のページ」ボタンで戻る

**8. アイテムの削除**
1. アイテムの編集ページを開く
2. 左下の「削除」ボタンをクリック
3. 確認ダイアログが表示される
4. 「OK」をクリック
5. 「アイテムを削除しました」のアラートが表示される
6. 一覧ページに戻り、アイテムが削除されている
7. Firebase Storage から画像も削除されていることを確認

#### エラーハンドリングのテスト

**バリデーションエラー**
- 名前が空: 「名前は必須です」のエラー表示
- SKU が空: 「SKUは必須です」のエラー表示
- 価格が負の数: 「価格は0以上である必要があります」のエラー表示

**画像アップロードエラー**
- 無効なファイル形式を選択: 「画像ファイルのみ選択してください」のアラート
- 10MB 以上のファイル: 「ファイルサイズは10MB以下にしてください」のアラート

**権限エラー**
- 未ログイン状態で `/items` へアクセス: ログインページへリダイレクト

#### テストケース一覧

| # | テストケース | 期待される結果 |
|---|------------|-------------|
| 1 | 新規作成: 全項目入力 + 画像2枚 | 作成成功、Firestore と Storage に保存 |
| 2 | 編集: 価格変更 + 画像追加 | 更新成功、変更が反映される |
| 3 | 編集: 既存画像を削除 | Storage から画像削除、Firestore も更新 |
| 4 | 削除: アイテム削除 | アイテムと全画像が削除される |
| 5 | 検索: 名前で部分一致検索 | 該当アイテムのみ表示 |
| 6 | 検索: SKU で部分一致検索 | 該当アイテムのみ表示 |
| 7 | ソート: 新しい順 → 古い順 | 並び順が変わる |
| 8 | ページング: 次ページへ移動 | 次の20件が表示される |
| 9 | バリデーション: 必須項目未入力 | エラーメッセージ表示 |
| 10 | 画像: 無効な形式を選択 | アラート表示、選択解除 |
| 11 | 詳細表示: 画像クリック | 新しいタブで画像が開く |
| 12 | 未ログイン: /items へアクセス | ログインページへリダイレクト |

### 9. 生地マスタ機能のテスト

#### 前提条件
- Firebase Firestore の `fabrics` コレクションが作成可能
- ログイン済みのユーザーアカウント

#### テスト手順

**1. 生地一覧の表示**
1. ダッシュボードの「生地マスタ」カード（緑色）をクリック
2. `/fabrics` ページが表示されることを確認
3. 初回は「生地がありません」と表示される
4. 「最初の生地を作成」または右上の「+ 新規作成」ボタンをクリック

**2. 新規生地の作成**
1. `/fabrics/new` ページが表示される
2. フォームに入力:
   - 生地品番: 「F-001」（必須）
   - 生地名: 「コットンツイル」（必須）
   - 混率: 「綿100%」（必須）
   - 生地値: 「1500」（必須、円/m）
   - メーカー: 「ABC繊維」（必須）
   - 担当者ID: 自動入力（現在のユーザー）
   - カテゴリ: 「布帛」または「カット」
   - パターン: 「無地」または「先染」
   - ステータス: 「有効」
3. 「作成」ボタンをクリック
4. 「生地を作成しました」のアラートが表示される
5. 一覧ページにリダイレクトされ、作成した生地が表示される

**3. Firebase での確認**
- **Firestore**: Firebase Console → Firestore → `fabrics` コレクション
  ```json
  {
    "fabricCode": "F-001",
    "fabricName": "コットンツイル",
    "composition": "綿100%",
    "price": 1500,
    "manufacturer": "ABC繊維",
    "fabricType": {
      "category": "布帛",
      "pattern": "無地"
    },
    "managerId": "user@example.com",
    "status": "active",
    "createdAt": "Timestamp",
    "updatedAt": "Timestamp"
  }
  ```

**4. 生地の編集**
1. 一覧から生地の行をクリック
2. 編集ページ `/fabrics/{id}` が表示される
3. フォームの内容を変更:
   - 生地値を「1800」に変更
   - カテゴリを「カット」に変更
4. 「更新」ボタンをクリック
5. 「生地を更新しました」のアラートが表示される
6. 一覧に戻り、変更が反映されていることを確認

**5. 生地の詳細表示**
1. ブラウザで `/fabrics/{id}/detail` へ直接アクセス
2. 生地の全情報が表示される
3. タイプがバッジ形式で表示される
4. 「編集」ボタンで編集ページへ遷移できる

**6. 検索とフィルター**
1. 一覧ページで検索ボックスに「コットン」と入力
2. 「検索」ボタンをクリック
3. 該当生地のみ表示される
4. カテゴリフィルターで「布帛」を選択
5. パターンフィルターで「無地」を選択
6. 条件に合う生地のみが表示される

**7. ページネーション**
1. 21件以上の生地を作成（テストデータ）
2. 一覧ページで 20件ずつ表示される
3. 「次のページ →」ボタンで次のページへ移動

**8. 生地の削除**
1. 生地の編集ページを開く
2. 左下の「削除」ボタンをクリック
3. 確認ダイアログが表示される
4. 「OK」をクリック
5. 「生地を削除しました」のアラートが表示される
6. 一覧ページに戻り、生地が削除されている

#### エラーハンドリングのテスト

**バリデーションエラー**
- 生地品番が空: 「生地品番は必須です」のエラー表示
- 生地名が空: 「生地名は必須です」のエラー表示
- 混率が空: 「混率は必須です」のエラー表示
- 生地値が負の数: 「生地値は0以上である必要があります」のエラー表示
- メーカーが空: 「メーカーは必須です」のエラー表示
- 担当者IDが空: 「担当者IDは必須です」のエラー表示

**権限エラー**
- 未ログイン状態で `/fabrics` へアクセス: ログインページへリダイレクト

#### テストケース一覧

| # | テストケース | 期待される結果 |
|---|------------|-------------|
| 1 | 新規作成: 全項目入力 | 作成成功、Firestore に保存 |
| 2 | 編集: 生地値変更 | 更新成功、変更が反映される |
| 3 | 編集: タイプ変更 | 更新成功、タイプが変更される |
| 4 | 削除: 生地削除 | 生地が削除される |
| 5 | 検索: 生地品番で検索 | 該当生地のみ表示 |
| 6 | 検索: 生地名で検索 | 該当生地のみ表示 |
| 7 | 検索: メーカーで検索 | 該当生地のみ表示 |
| 8 | フィルター: カテゴリで絞り込み | 該当生地のみ表示 |
| 9 | フィルター: パターンで絞り込み | 該当生地のみ表示 |
| 10 | ソート: 新しい順 → 古い順 | 並び順が変わる |
| 11 | ページング: 次ページへ移動 | 次の20件が表示される |
| 12 | バリデーション: 必須項目未入力 | エラーメッセージ表示 |
| 13 | 詳細表示: タイプバッジ | カテゴリとパターンがバッジ表示 |
| 14 | 未ログイン: /fabrics へアクセス | ログインページへリダイレクト |

### 10. 型紙マスタ機能のテスト

#### 前提条件
- Firebase Firestore の `patterns` コレクションが作成可能
- Firebase Storage のセキュリティルールが `request.auth != null` で設定済み
- ログイン済みのユーザーアカウント
- テスト用のPDFファイル（20MB以下）

#### テスト手順

**1. 型紙一覧の表示**
1. ダッシュボードの「型紙マスタ」カード（紫色）をクリック
2. `/patterns` ページが表示されることを確認
3. 初回は「型紙がありません」と表示される
4. 「最初の型紙を作成」または右上の「+ 新規作成」ボタンをクリック

**2. 新規型紙の作成**
1. `/patterns/new` ページが表示される
2. フォームに入力:
   - 型紙No.: 「PT-001」（必須）
   - 型紙名: 「基本シャツ型紙」（必須）
   - 担当者ID: 自動入力（現在のユーザー）
   - ステータス: 「有効」
3. 「作成」ボタンをクリック
4. 「型紙を作成しました。ファイルをアップロードできます。」のアラートが表示される
5. 編集ページへリダイレクトされる

**3. PDFファイルのアップロード**
1. 編集ページの「ファイル管理」セクションで:
   - 型紙ファイル: PDFを選択してアップロード
   - 仕様書: PDFを選択してアップロード
   - 展開図: PDFを選択してアップロード
2. 各ファイルアップロード後、「ファイルをアップロードしました」のアラートが表示される
3. アップロードされたファイルがファイル名とともに表示される
4. 「ファイルを開く」リンクで新しいタブでPDFが開くことを確認

**4. Firebase での確認**
- **Firestore**: Firebase Console → Firestore → `patterns` コレクション
  ```json
  {
    "patternCode": "PT-001",
    "patternName": "基本シャツ型紙",
    "files": {
      "pattern": {
        "fileName": "pattern.pdf",
        "fileUrl": "https://..."
      },
      "spec": {
        "fileName": "spec.pdf",
        "fileUrl": "https://..."
      },
      "layout": {
        "fileName": "layout.pdf",
        "fileUrl": "https://..."
      }
    },
    "managerId": "user@example.com",
    "status": "active",
    "createdAt": "Timestamp",
    "updatedAt": "Timestamp"
  }
  ```
- **Storage**: Firebase Console → Storage → `patterns/{patternId}/` フォルダに3種類のPDFが保存されている

**5. 型紙の編集**
1. 一覧から型紙の行をクリック
2. 編集ページ `/patterns/{id}` が表示される
3. 型紙名を「基本シャツ型紙 v2」に変更
4. 「更新」ボタンをクリック
5. 「型紙を更新しました」のアラートが表示される

**6. ファイルの削除と再アップロード**
1. 編集ページで「型紙ファイル」の「削除」ボタンをクリック
2. 確認ダイアログで「OK」をクリック
3. ファイルが削除され、アップロード欄が表示される
4. 新しいPDFファイルを選択してアップロード
5. Storage から旧ファイルが削除され、新ファイルがアップロードされる

**7. 型紙の詳細表示**
1. ブラウザで `/patterns/{id}/detail` へ直接アクセス
2. 型紙の全情報が表示される
3. ファイルセクションで3種類のファイルの状態が確認できる
4. 「ダウンロード / 表示」リンクでPDFが開く

**8. 検索とソート**
1. 一覧ページで検索ボックスに「シャツ」と入力
2. 「検索」ボタンをクリック
3. 該当型紙のみ表示される

**9. 型紙の削除**
1. 型紙の編集ページを開く
2. 左下の「削除」ボタンをクリック
3. 確認ダイアログが表示される
4. 「OK」をクリック
5. 「型紙を削除しました」のアラートが表示される
6. 一覧ページに戻り、型紙が削除されている
7. Firebase Storage からすべてのPDFファイルも削除されている

#### エラーハンドリングのテスト

**バリデーションエラー**
- 型紙No.が空: 「型紙No.は必須です」のエラー表示
- 型紙名が空: 「型紙名は必須です」のエラー表示
- 担当者IDが空: 「担当者IDは必須です」のエラー表示

**ファイルアップロードエラー**
- 新規作成時にファイルアップロード: 「先に型紙を作成してから...」のアラート
- PDFでないファイルを選択: 「PDFファイルのみアップロード可能です」のアラート
- 20MB以上のファイル: 「ファイルサイズは20MB以下にしてください」のアラート

**権限エラー**
- 未ログイン状態で `/patterns` へアクセス: ログインページへリダイレクト

#### テストケース一覧

| # | テストケース | 期待される結果 |
|---|------------|-------------|
| 1 | 新規作成: 基本情報のみ | 作成成功、Firestore に保存 |
| 2 | ファイルアップロード: 型紙 | Storage に保存、Firestore に URL 保存 |
| 3 | ファイルアップロード: 仕様書 | Storage に保存、Firestore に URL 保存 |
| 4 | ファイルアップロード: 展開図 | Storage に保存、Firestore に URL 保存 |
| 5 | ファイル削除: 個別削除 | Storage から削除、Firestore から削除 |
| 6 | ファイル置き換え: 削除→再アップロード | 旧ファイル削除、新ファイル保存 |
| 7 | 編集: 型紙名変更 | 更新成功、変更が反映される |
| 8 | 削除: 型紙削除 | 型紙と全PDFファイルが削除される |
| 9 | 検索: 型紙No.で検索 | 該当型紙のみ表示 |
| 10 | 検索: 型紙名で検索 | 該当型紙のみ表示 |
| 11 | ソート: 新しい順 → 古い順 | 並び順が変わる |
| 12 | ページング: 次ページへ移動 | 次の20件が表示される |
| 13 | バリデーション: 必須項目未入力 | エラーメッセージ表示 |
| 14 | ファイル: PDF以外を選択 | アラート表示、選択解除 |
| 15 | ファイル: 20MB超を選択 | アラート表示、選択解除 |
| 16 | 詳細表示: PDFリンク | 新しいタブでPDFが開く |
| 17 | 未ログイン: /patterns へアクセス | ログインページへリダイレクト |

### 11. 型紙データファイルとアイテム紐付け機能のテスト

#### 前提条件
- 型紙マスタ機能が実装済み
- アイテム管理機能が実装済み
- ログイン済みのユーザーアカウント
- テスト用の型紙データファイル（DXF, AI, CDR, ZIP など、50MB以下）

#### 機能概要
1. **型紙データファイルのアップロード**: CADファイル（DXF、AI、CDRなど）を型紙に追加可能
2. **アイテムと型紙の紐付け**: アイテムに型紙を関連付けて一元管理

#### テスト手順

**1. 型紙データファイルのアップロード**
1. 型紙の編集ページ (`/patterns/{id}`) を開く
2. 「ファイル管理」セクションに4種類のファイルタイプが表示される:
   - 型紙ファイル（PDFのみ、最大20MB）
   - 仕様書（PDFのみ、最大20MB）
   - 展開図（PDFのみ、最大20MB）
   - **型紙データファイル**（DXF, AI, CDR, PDF, ZIP など、最大50MB）
3. 「型紙データファイル」セクションでCADファイル（例: pattern.dxf）を選択
4. アップロードが成功し、「ファイルをアップロードしました」のアラートが表示される
5. ファイル名と「ファイルを開く」リンクが表示される

**2. 型紙一覧でのデータファイル表示**
1. 型紙一覧ページ (`/patterns`) へ移動
2. 型紙データファイルがアップロードされている型紙の「ファイル」列に:
   - 「型紙」バッジ（青色）
   - 「仕様書」バッジ（緑色）
   - 「展開図」バッジ（紫色）
   - 「データ」バッジ（オレンジ色）が表示される
3. データファイルがアップロードされていない型紙では「データ」バッジが表示されない

**3. アイテムに型紙を紐付け**
1. アイテム作成ページ (`/items/new`) または編集ページ (`/items/{id}`) を開く
2. フォームに新しいフィールド「型紙」が追加されている
3. ドロップダウンから型紙を選択:
   - 「-- 型紙を選択 --」（未選択）
   - 「PT-001 - 基本シャツ型紙」
   - 「PT-002 - パンツ型紙」など
4. 他の必須項目を入力して「作成」または「更新」をクリック
5. アイテムが保存され、型紙との紐付けが完了

**4. アイテム一覧での型紙表示**
1. アイテム一覧ページ (`/items`) へ移動
2. テーブルに新しい列「型紙」が追加されている
3. 型紙が紐づいているアイテムには:
   - 型紙コード（例: 「PT-001」）が紫色のバッジで表示される
4. 型紙が未設定のアイテムには「未設定」と灰色で表示される

**5. アイテム詳細での型紙表示**
1. アイテム詳細ページ (`/items/{id}/detail`) を開く
2. 「基本情報」セクションに「型紙」フィールドが追加されている
3. 型紙が紐づいている場合:
   - 「PT-001 - 基本シャツ型紙」とリンク形式で表示される
   - クリックすると型紙詳細ページへ遷移
4. 型紙が未設定の場合:
   - 「未設定」と灰色で表示される

**6. 型紙詳細でのアイテム一覧表示**
1. 型紙詳細ページ (`/patterns/{id}/detail`) を開く
2. 「型紙データファイル」セクションでデータファイルが表示される
3. 新しいセクション「紐づいたアイテム」が表示される:
   - タイトルに件数が表示（例: 「紐づいたアイテム (3件)」）
   - テーブルでアイテム情報が表示:
     - 名前
     - SKU
     - 価格
     - ステータス
4. アイテムの行をクリックするとそのアイテムの詳細ページへ遷移
5. 紐づいたアイテムがない場合:
   - 「この型紙に紐づいたアイテムはありません」と表示される

**7. Firebase での確認**
- **Firestore (patterns)**:
  ```json
  {
    "patternCode": "PT-001",
    "patternName": "基本シャツ型紙",
    "files": {
      "pattern": { "fileName": "pattern.pdf", "fileUrl": "https://..." },
      "spec": { "fileName": "spec.pdf", "fileUrl": "https://..." },
      "layout": { "fileName": "layout.pdf", "fileUrl": "https://..." },
      "data": {
        "fileName": "pattern.dxf",
        "fileUrl": "https://..."
      }
    },
    "managerId": "user@example.com",
    "status": "active",
    "createdAt": "Timestamp",
    "updatedAt": "Timestamp"
  }
  ```

- **Firestore (items)**:
  ```json
  {
    "name": "白シャツ",
    "sku": "SH-001",
    "price": 5000,
    "patternId": "pattern-document-id",
    "status": "active",
    "createdAt": "Timestamp",
    "updatedAt": "Timestamp"
  }
  ```

- **Storage**: `patterns/{patternId}/data/` フォルダに型紙データファイルが保存されている

#### エラーハンドリングのテスト

**型紙データファイル関連**
- DXF/AI/CDR以外の不正なファイル: 「型紙データファイル（DXF, AI, CDR, PDF, ZIP など）をアップロードしてください」のエラー
- 50MB超のファイル: 「ファイルサイズは50MB以下にしてください」のアラート

**アイテム紐付け関連**
- 型紙が削除されたアイテム: 詳細ページで「未設定」と表示
- 無効な型紙IDが保存されている: エラーログに記録されるが表示は正常

#### テストケース一覧

| # | テストケース | 期待される結果 |
|---|------------|-------------|
| 1 | データファイルアップロード: DXF | Storage に保存、Firestore に URL 保存 |
| 2 | データファイルアップロード: AI | Storage に保存、Firestore に URL 保存 |
| 3 | データファイルアップロード: ZIP | Storage に保存、Firestore に URL 保存 |
| 4 | データファイル削除 | Storage から削除、Firestore から削除 |
| 5 | 型紙一覧: データバッジ表示 | オレンジ色の「データ」バッジが表示 |
| 6 | アイテム作成: 型紙選択 | ドロップダウンから選択、保存成功 |
| 7 | アイテム編集: 型紙変更 | 別の型紙に変更可能 |
| 8 | アイテム編集: 型紙解除 | 「-- 型紙を選択 --」で解除可能 |
| 9 | アイテム一覧: 型紙列表示 | 型紙コードバッジまたは「未設定」表示 |
| 10 | アイテム詳細: 型紙リンク | クリックで型紙詳細へ遷移 |
| 11 | 型紙詳細: 紐づいたアイテム一覧 | 該当アイテムがテーブル表示 |
| 12 | 型紙詳細: アイテムへ遷移 | アイテム行クリックで詳細ページへ |
| 13 | データファイル: 50MB超 | エラーアラート表示 |
| 14 | データファイル: 不正な形式 | エラーメッセージ表示 |

## 📝 開発コマンド

```bash
# 開発サーバー起動
npm run dev

# ビルド
npm run build

# ビルドのプレビュー
npm run preview

# リント
npm run lint

# フォーマット
npm run format

# Firebase デプロイ
firebase deploy

# Firestore ルールのみデプロイ
firebase deploy --only firestore:rules

# Hosting のみデプロイ
firebase deploy --only hosting
```

## 🗄️ データ構造

### 主要コレクション

#### items (アイテム)
```typescript
{
  itemCode: string;              // 品番 (例: IT-2024-001)
  itemName: string;              // アイテム名
  brandId: string;               // ブランドID
  category: string;              // カテゴリ
  season: string;                // シーズン
  pricing: {
    dollarPrice: number;         // $販売単価
    costPrice: number;           // $原価 (管理者のみ)
    sellingPrice: number;        // 円換算価格
    lotCondition: string;        // ロット条件
  };
  mainFabricId: string;          // 生地ID
  patternId: string;             // 型紙ID
  production: {
    factory: string;             // 工場名
    moq: number;                 // 最小発注数
    leadTime: string;            // リードタイム
  };
  images: string[];              // 画像URL配列
  status: string;                // active/inactive
}
```

#### fabrics (生地)
```typescript
{
  fabricCode: string;            // 生地品番 (例: F-001)
  fabricName: string;            // 生地名
  composition: string;           // 混率
  price: number;                 // 生地値 (円/m)
  manufacturer: string;          // メーカー
  fabricType: {
    category: string;            // 布帛/カット
    pattern: string;             // 無地/先染
  };
  managerId: string;             // 担当者ID
  status: string;
}
```

#### patterns (型紙)
```typescript
{
  patternCode: string;           // 型紙No. (例: PT-001)
  patternName: string;           // 型紙名
  files: {
    pattern?: {                  // 型紙ファイル
      fileName: string;
      fileUrl: string;
    };
    spec?: {};                   // 仕様書
    layout?: {};                 // 展開図
  };
  managerId: string;
  status: string;
}
```

#### uploads (画像アップロード)
```typescript
{
  url: string;                   // ダウンロードURL
  path: string;                  // Storageパス (例: uploads/uuid-filename.jpg)
  contentType: string;           // MIMEタイプ (例: image/jpeg)
  size: number;                  // ファイルサイズ (bytes)
  createdAt: Timestamp;          // アップロード日時
  createdBy: string;             // アップロード者のメールまたはUID
}
```

詳細は `DESIGN.md` を参照

## 📱 主な機能

### 1. アイテム管理（実装済み✅）
- **一覧表示**: テーブル形式で商品情報を表示、サムネイル付き
- **検索機能**: 名前・SKU による部分一致検索
- **ソート**: 更新日時で昇順・降順の並び替え
- **ページネーション**: 20件ごとのページング（次へ・前へ）
- **CRUD 操作**: 作成・編集・削除の完全サポート
- **画像管理**: 複数画像のアップロード・削除（Firebase Storage 連携）
- **ステータス管理**: 有効/アーカイブのステータス切り替え
- **バリデーション**: 必須項目チェック、価格の数値検証
- **詳細表示**: 画像ギャラリーと全情報の表示

### 2. 生地マスタ（実装済み✅）
- **一覧表示**: テーブル形式で生地情報を表示
- **検索機能**: 生地品番・生地名・メーカーによる部分一致検索
- **フィルター**: カテゴリ（布帛/カット）、パターン（無地/先染）での絞り込み
- **ソート**: 更新日時で昇順・降順の並び替え
- **ページネーション**: 20件ごとのページング
- **CRUD 操作**: 作成・編集・削除の完全サポート
- **生地タイプ管理**: 布帛/カット、無地/先染の分類
- **担当者管理**: 担当者IDによる管理
- **バリデーション**: 必須項目チェック、生地値の数値検証

### 3. 型紙マスタ（実装済み✅）
- **一覧表示**: テーブル形式で型紙情報を表示
- **検索機能**: 型紙No.・型紙名による部分一致検索
- **ソート**: 更新日時で昇順・降順の並び替え
- **ページネーション**: 20件ごとのページング
- **CRUD 操作**: 作成・編集・削除の完全サポート
- **PDF管理**: 型紙・仕様書・展開図の3種類のPDFファイルをアップロード
- **ファイル操作**: 個別ファイルのアップロード・削除・ダウンロード
- **担当者管理**: 担当者IDによる管理
- **バリデーション**: 必須項目チェック、PDFファイル形式・サイズ検証（最大20MB）

### 4. 展示会カタログ
- A4横向き自動生成
- 8/10/12アイテム/ページから選択
- カテゴリ別のセクション分け
- 表紙・目次の自動生成

### 5. サンプル貸出
- シンプルな貸出登録
- 貸出中一覧の管理
- ワンクリック返却処理
- 貸出履歴の記録

### 6. ピックアップリスト
- 展示会での商品選定
- PDF出力
- Web共有URL生成
- 顧客向けページ（認証不要）

### 7. データ連携
- CSVインポート/エクスポート
- Excelインポート/エクスポート
- 管理者用コスト情報出力

## 🔐 セキュリティ

### Firestore セキュリティルール
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 認証済みユーザーのみアクセス可能
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

### Storage セキュリティルール
```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null 
                   && request.resource.size < 5 * 1024 * 1024; // 5MB制限
    }
  }
}
```

## 🧪 テスト

```bash
# ユニットテスト
npm run test

# カバレッジ
npm run test:coverage

# E2Eテスト (Playwright)
npm run test:e2e
```

## 📊 開発フェーズ

### Phase 1: 基本機能 (3-4ヶ月)
- ✅ 認証システム
- ✅ マスタ管理（ブランド、担当者、生地、型紙、アイテム）
- ✅ 検索・フィルタ
- ✅ 一覧表示（グリッド/テーブル）
- ⏳ モバイル対応（レスポンシブ、カメラ連携）

### Phase 2: 展示会機能 (1-2ヶ月)
- ⏳ 展示会カタログPDF出力
- ⏳ 下げ札シール出力
- ⏳ お客様ピックアップ
- ⏳ 顧客向けWeb共有

### Phase 3: サンプル貸出 (1ヶ月)
- ⏳ 貸出登録
- ⏳ 貸出中一覧
- ⏳ 返却処理
- ⏳ 貸出履歴

### Phase 4: データ連携 (1ヶ月)
- ⏳ CSVインポート/エクスポート
- ⏳ Excelインポート/エクスポート
- ⏳ テンプレート提供

### Phase 5: 改善・最適化 (継続)
- ⏳ オフライン機能強化
- ⏳ パフォーマンス改善
- ⏳ UI/UX改善

## 🤝 貢献

### ブランチ戦略
- `main`: 本番環境
- `develop`: 開発環境
- `feature/*`: 機能開発
- `bugfix/*`: バグ修正

### コミットメッセージ規約
```
feat: 新機能
fix: バグ修正
docs: ドキュメント
style: コードスタイル
refactor: リファクタリング
test: テスト
chore: その他
```

例:
```bash
git commit -m "feat: アイテム一覧にコスト表示切り替え機能を追加"
```

## 📄 ライセンス

MIT License

## 📞 サポート

### ドキュメント
- [詳細設計書](DESIGN.md)
- [Firebase公式ドキュメント](https://firebase.google.com/docs)
- [React公式ドキュメント](https://react.dev/)

### 問い合わせ
- Email: support@example.com
- Issues: [GitHub Issues](https://github.com/your-org/apparel-management-system/issues)

## 🎉 リリースノート

### v1.0.0 (予定: 2025年Q2)
- アイテム管理機能
- 生地・型紙マスタ
- 基本的な検索・フィルタ
- モバイル対応

### v1.1.0 (予定: 2025年Q3)
- 展示会カタログ出力
- サンプル貸出管理
- お客様ピックアップ

### v1.2.0 (予定: 2025年Q4)
- データ連携機能
- オフライン対応強化
- パフォーマンス最適化

---

**開発チーム**: Your Company © 2025
