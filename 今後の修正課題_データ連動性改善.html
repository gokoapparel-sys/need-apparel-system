<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>今後の修正課題：データ連動性改善</title>
    <style>
        body {
            font-family: 'Yu Gothic', 'Hiragino Kaku Gothic Pro', 'Meiryo', sans-serif;
            line-height: 1.8;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 60px;
            background: #ffffff;
            color: #333;
        }
        h1 {
            color: #1e3a8a;
            border-bottom: 4px solid #2563eb;
            padding-bottom: 12px;
            margin-top: 40px;
            font-size: 32px;
        }
        h2 {
            color: #2563eb;
            border-left: 6px solid #3b82f6;
            padding-left: 16px;
            margin-top: 36px;
            font-size: 24px;
        }
        h3 {
            color: #059669;
            margin-top: 28px;
            font-size: 20px;
        }
        hr {
            border: none;
            border-top: 2px solid #e5e7eb;
            margin: 32px 0;
        }
        p {
            margin: 12px 0;
        }
        strong {
            color: #1e3a8a;
            font-weight: bold;
        }
        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            color: #dc2626;
        }
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            line-height: 1.6;
        }
        pre code {
            background: transparent;
            color: #e2e8f0;
            padding: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        th {
            background: #2563eb;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        tr:nth-child(even) {
            background: #f9fafb;
        }
        ul, ol {
            padding-left: 28px;
            margin: 12px 0;
        }
        li {
            margin: 8px 0;
        }
        blockquote {
            border-left: 4px solid #fbbf24;
            background: #fef3c7;
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .header-info {
            background: #f1f5f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 32px;
        }
        .merit {
            color: #059669;
        }
        .demerit {
            color: #dc2626;
        }
        .pattern-box {
            background: #f8fafc;
            border: 2px solid #cbd5e1;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        @media print {
            body {
                padding: 20px;
            }
            h1 {
                page-break-after: avoid;
            }
            h2, h3 {
                page-break-after: avoid;
            }
            pre, table, .pattern-box {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <h1>今後の修正課題：データ連動性改善</h1>

    <div class="header-info">
        <p><strong>作成日</strong>: 2025年11月2日<br>
        <strong>対象システム</strong>: GOKO アパレル商品管理システム</p>
    </div>

    <hr>

    <h2>概要</h2>
    <p>現在、アイテム・生地・型紙の各マスタ間で連動性が不十分な状態です。<br>
    本ドキュメントでは、データの一貫性を保ち、入力ミスを防ぐための改善案を整理します。</p>

    <hr>

    <h2>1. 現状の問題点</h2>

    <h3>1-1. 生地マスタとアイテムの連動性なし</h3>

    <p><strong>現在の実装:</strong></p>
    <pre><code>// アイテム型 (src/types/index.ts)
export interface Item {
  fabricNo?: string      // 単なる文字列フィールド
  composition?: string   // 混率（生地マスタと重複）
  // ...
}

// 生地型 (src/types/index.ts)
export interface Fabric {
  fabricCode: string
  fabricName: string
  composition: string    // アイテムと重複している情報
  price: number
  manufacturer: string
  // ...
}</code></pre>

    <p><strong>問題点:</strong></p>
    <ul>
        <li class="demerit">✗ 生地番号を手動入力するため、タイプミスのリスク</li>
        <li class="demerit">✗ 存在しない生地番号を入力できてしまう</li>
        <li class="demerit">✗ 生地マスタで情報を変更しても既存アイテムに反映されない</li>
        <li class="demerit">✗ 混率が二重管理（Item.composition と Fabric.composition）</li>
        <li class="demerit">✗ 生地の詳細情報（メーカー、価格等）を参照できない</li>
    </ul>

    <h3>1-2. 型紙マスタとアイテムの連動性（部分的）</h3>

    <p><strong>現在の実装:</strong></p>
    <pre><code>export interface Item {
  patternId?: string     // 型紙IDで参照可能
  patternNo?: string     // 型紙No.（表示用）
  // ...
}</code></pre>

    <p><strong>状況:</strong></p>
    <ul>
        <li class="merit">◯ <code>patternId</code> で型紙マスタを参照可能な構造</li>
        <li>△ 実際の連動機能（選択UI、自動補完等）は未実装</li>
    </ul>

    <hr>

    <h2>2. 検討が必要な項目</h2>

    <h3>2-1. アイテム登録時の項目見直し</h3>

    <p><strong>現在のアイテム項目:</strong></p>
    <table>
        <thead>
            <tr>
                <th>項目名</th>
                <th>型</th>
                <th>備考</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>itemNo</td><td>string</td><td>品番（必須）</td></tr>
            <tr><td>name</td><td>string</td><td>アイテム名（必須）</td></tr>
            <tr><td>fabricNo</td><td>string</td><td>生地No.（<strong>文字列入力</strong>）</td></tr>
            <tr><td>composition</td><td>string</td><td>混率（<strong>生地と重複</strong>）</td></tr>
            <tr><td>dollarPrice</td><td>number</td><td>＄単価</td></tr>
            <tr><td>moq</td><td>string</td><td>単価枚数条件</td></tr>
            <tr><td>referencePrice</td><td>number</td><td>売単価（参考）</td></tr>
            <tr><td>factory</td><td>string</td><td>工場名</td></tr>
            <tr><td>sizeOptions</td><td>string</td><td>サイズ展開</td></tr>
            <tr><td>colorOptions</td><td>string</td><td>色展開</td></tr>
            <tr><td>patternId</td><td>string</td><td>型紙ID</td></tr>
            <tr><td>patternNo</td><td>string</td><td>型紙No.</td></tr>
            <tr><td>images</td><td>array</td><td>画像</td></tr>
        </tbody>
    </table>

    <p><strong>検討ポイント:</strong></p>
    <ul>
        <li><input type="checkbox"> <code>fabricNo</code> を文字列のままにするか、<code>fabricId</code> に変更するか</li>
        <li><input type="checkbox"> <code>composition</code> を残すか、生地マスタから取得するか</li>
        <li><input type="checkbox"> 生地情報の上書き可否（マスタ優先 or 個別設定可能）</li>
    </ul>

    <h3>2-2. 生地登録の基本情報確認</h3>

    <p><strong>現在の生地マスタ項目:</strong></p>
    <table>
        <thead>
            <tr>
                <th>項目名</th>
                <th>型</th>
                <th>備考</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>fabricCode</td><td>string</td><td>生地コード（必須）</td></tr>
            <tr><td>fabricName</td><td>string</td><td>生地名（必須）</td></tr>
            <tr><td>composition</td><td>string</td><td>混率</td></tr>
            <tr><td>price</td><td>number</td><td>価格</td></tr>
            <tr><td>manufacturer</td><td>string</td><td>メーカー</td></tr>
            <tr><td>fabricType</td><td>object</td><td>布帛/カット、無地/先染</td></tr>
            <tr><td>managerId</td><td>string</td><td>担当者ID</td></tr>
        </tbody>
    </table>

    <p><strong>検討ポイント:</strong></p>
    <ul>
        <li><input type="checkbox"> 必要な項目が揃っているか</li>
        <li><input type="checkbox"> 追加すべき項目はないか（例：ロット数、リードタイム等）</li>
        <li><input type="checkbox"> 価格の単位・基準の明確化</li>
    </ul>

    <h3>2-3. 型紙登録の基本情報確認</h3>

    <p><strong>現在の型紙マスタ項目:</strong></p>
    <table>
        <thead>
            <tr>
                <th>項目名</th>
                <th>型</th>
                <th>備考</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>patternCode</td><td>string</td><td>型紙コード（必須）</td></tr>
            <tr><td>patternName</td><td>string</td><td>型紙名（必須）</td></tr>
            <tr><td>files.spec</td><td>object</td><td>仕様書ファイル</td></tr>
            <tr><td>files.layout</td><td>object</td><td>展開図ファイル</td></tr>
            <tr><td>files.data</td><td>object</td><td>型紙データ（DXF/AI/CDR等）</td></tr>
            <tr><td>managerId</td><td>string</td><td>担当者ID</td></tr>
        </tbody>
    </table>

    <p><strong>検討ポイント:</strong></p>
    <ul>
        <li><input type="checkbox"> 現状の項目で十分か</li>
        <li><input type="checkbox"> サイズ情報の管理方法</li>
    </ul>

    <hr>

    <h2>3. 連動性改善の実装パターン案</h2>

    <div class="pattern-box">
        <h3>パターンA：完全連動型（推奨）</h3>

        <p><strong>概要:</strong></p>
        <ul>
            <li>アイテム登録時に生地マスタと型紙マスタから選択</li>
            <li>関連情報は自動取得</li>
            <li>データの一貫性が最も高い</li>
        </ul>

        <p><strong>実装イメージ:</strong></p>
        <pre><code>export interface Item {
  itemNo: string
  name: string
  fabricId: string       // ← 生地IDで紐付け
  patternId: string      // ← 型紙IDで紐付け
  // composition は削除（生地マスタから取得）
  // fabricNo は削除（生地マスタから取得）
  // ...
}</code></pre>

        <p><strong>メリット:</strong></p>
        <ul>
            <li class="merit">✓ タイプミス防止</li>
            <li class="merit">✓ 存在しない生地/型紙を選択できない</li>
            <li class="merit">✓ 生地マスタ更新時に最新情報を参照可能</li>
            <li class="merit">✓ データの一貫性が保たれる</li>
        </ul>

        <p><strong>デメリット:</strong></p>
        <ul>
            <li class="demerit">✗ 必ず生地マスタ・型紙マスタへの登録が必要</li>
            <li class="demerit">✗ 既存データの移行が必要</li>
            <li class="demerit">✗ 柔軟性が低い（特殊ケース対応が困難）</li>
        </ul>
    </div>

    <div class="pattern-box">
        <h3>パターンB：参照型（現状改善版）</h3>

        <p><strong>概要:</strong></p>
        <ul>
            <li>生地No./型紙No.入力時にマスタを検索</li>
            <li>存在する場合は情報を自動補完</li>
            <li>ただし手動での上書き可能</li>
        </ul>

        <p><strong>実装イメージ:</strong></p>
        <pre><code>export interface Item {
  itemNo: string
  name: string
  fabricNo: string       // ← 文字列のまま（入力時にマスタ検索）
  fabricId?: string      // ← マスタにある場合は参照
  composition: string    // ← マスタから取得、上書き可能
  patternNo: string
  patternId?: string
  // ...
}</code></pre>

        <p><strong>メリット:</strong></p>
        <ul>
            <li class="merit">✓ 柔軟性が高い（特殊ケースにも対応可）</li>
            <li class="merit">✓ 既存データとの互換性が高い</li>
            <li class="merit">✓ 段階的な移行が可能</li>
        </ul>

        <p><strong>デメリット:</strong></p>
        <ul>
            <li>△ データの一貫性は完全ではない</li>
            <li>△ ユーザーが上書きした場合、マスタと不一致になる</li>
        </ul>
    </div>

    <div class="pattern-box">
        <h3>パターンC：現状維持（自由入力）</h3>

        <p><strong>概要:</strong></p>
        <ul>
            <li>現在のまま文字列入力を継続</li>
            <li>既存システムとの互換性を最優先</li>
        </ul>

        <p><strong>メリット:</strong></p>
        <ul>
            <li class="merit">✓ 既存データの移行不要</li>
            <li class="merit">✓ 柔軟性が最も高い</li>
        </ul>

        <p><strong>デメリット:</strong></p>
        <ul>
            <li class="demerit">✗ タイプミス・入力ミスのリスク</li>
            <li class="demerit">✗ データの一貫性なし</li>
            <li class="demerit">✗ 生地マスタの活用が限定的</li>
        </ul>
    </div>

    <hr>

    <h2>4. 既存データとの互換性</h2>

    <h3>4-1. データ移行の必要性</h3>

    <p><strong>パターンAを選択した場合:</strong></p>
    <ul>
        <li>既存アイテムの <code>fabricNo</code> → <code>fabricId</code> への変換が必要</li>
        <li>生地マスタに存在しない生地番号の場合、事前登録が必要</li>
    </ul>

    <p><strong>パターンBを選択した場合:</strong></p>
    <ul>
        <li>既存データはそのまま使用可能</li>
        <li>新規登録時から新方式を適用</li>
    </ul>

    <h3>4-2. 移行手順（パターンA採用時）</h3>

    <ol>
        <li>
            <strong>生地マスタの整備</strong>
            <ul>
                <li>現在使用中の全生地を生地マスタに登録</li>
                <li>重複チェック・データクレンジング</li>
            </ul>
        </li>
        <li>
            <strong>アイテムデータの変換</strong>
            <ul>
                <li><code>fabricNo</code> → 生地マスタを検索 → <code>fabricId</code> を設定</li>
                <li>マッチングしないデータは手動確認</li>
            </ul>
        </li>
        <li>
            <strong>型定義の変更</strong>
            <ul>
                <li>Item型から <code>fabricNo</code>, <code>composition</code> を削除</li>
                <li><code>fabricId</code> を必須化</li>
            </ul>
        </li>
        <li>
            <strong>UI/フォームの改修</strong>
            <ul>
                <li>生地選択をドロップダウン/検索式に変更</li>
                <li>混率の自動表示機能追加</li>
            </ul>
        </li>
    </ol>

    <hr>

    <h2>5. 推奨される実装順序</h2>

    <h3>フェーズ1：準備（1-2週間）</h3>
    <ul>
        <li><input type="checkbox"> 運用フローの確認（生地登録タイミング、担当者等）</li>
        <li><input type="checkbox"> 連動パターンの決定（A/B/Cから選択）</li>
        <li><input type="checkbox"> 既存データの棚卸し（使用中の生地・型紙リスト作成）</li>
    </ul>

    <h3>フェーズ2：マスタデータ整備（1-2週間）</h3>
    <ul>
        <li><input type="checkbox"> 生地マスタへの既存生地登録</li>
        <li><input type="checkbox"> 型紙マスタへの既存型紙登録</li>
        <li><input type="checkbox"> データの重複チェック・クレンジング</li>
    </ul>

    <h3>フェーズ3：システム改修（2-3週間）</h3>
    <ul>
        <li><input type="checkbox"> 型定義の変更</li>
        <li><input type="checkbox"> データベーススキーマの更新</li>
        <li><input type="checkbox"> アイテム登録フォームのUI改修</li>
        <li><input type="checkbox"> 生地/型紙選択機能の実装</li>
        <li><input type="checkbox"> 自動補完機能の実装</li>
    </ul>

    <h3>フェーズ4：データ移行（1週間）</h3>
    <ul>
        <li><input type="checkbox"> 既存アイテムデータの変換スクリプト作成</li>
        <li><input type="checkbox"> テスト環境での移行テスト</li>
        <li><input type="checkbox"> 本番環境での移行実施</li>
        <li><input type="checkbox"> 移行結果の検証</li>
    </ul>

    <h3>フェーズ5：運用開始・調整（継続）</h3>
    <ul>
        <li><input type="checkbox"> ユーザートレーニング</li>
        <li><input type="checkbox"> 問題点の洗い出し・修正</li>
        <li><input type="checkbox"> 運用マニュアルの更新</li>
    </ul>

    <hr>

    <h2>6. 検討事項チェックリスト</h2>

    <h3>システム設計</h3>
    <ul>
        <li><input type="checkbox"> 連動パターンの決定（A/B/C）</li>
        <li><input type="checkbox"> アイテム項目の見直し・確定</li>
        <li><input type="checkbox"> 生地マスタ項目の見直し・確定</li>
        <li><input type="checkbox"> 型紙マスタ項目の見直し・確定</li>
        <li><input type="checkbox"> データ移行方針の決定</li>
    </ul>

    <h3>運用フロー</h3>
    <ul>
        <li><input type="checkbox"> 生地登録のタイミング（アイテム登録前？後？）</li>
        <li><input type="checkbox"> 型紙登録のタイミング</li>
        <li><input type="checkbox"> データ管理の責任者・担当者</li>
        <li><input type="checkbox"> 承認フローの有無</li>
    </ul>

    <h3>ユーザビリティ</h3>
    <ul>
        <li><input type="checkbox"> 生地選択UIの形式（ドロップダウン/検索/オートコンプリート）</li>
        <li><input type="checkbox"> 型紙選択UIの形式</li>
        <li><input type="checkbox"> 入力補助機能（候補表示、プレビュー等）</li>
        <li><input type="checkbox"> エラーチェック・バリデーション</li>
    </ul>

    <h3>データ管理</h3>
    <ul>
        <li><input type="checkbox"> 既存データのバックアップ方針</li>
        <li><input type="checkbox"> マスタデータの更新頻度</li>
        <li><input type="checkbox"> データの削除ルール（アイテムで使用中の生地は削除不可等）</li>
    </ul>

    <hr>

    <h2>7. 次のステップ</h2>

    <ol>
        <li>
            <strong>管理者会議で検討</strong>
            <ul>
                <li>本ドキュメントをもとに実装パターンを決定</li>
                <li>優先順位・スケジュールの確認</li>
            </ul>
        </li>
        <li>
            <strong>詳細設計</strong>
            <ul>
                <li>決定した実装パターンに基づく詳細設計</li>
                <li>画面レイアウト・UIの確定</li>
            </ul>
        </li>
        <li>
            <strong>開発着手</strong>
            <ul>
                <li>システム改修の実施</li>
                <li>テスト・検証</li>
            </ul>
        </li>
    </ol>

    <hr>

    <h2>参考情報</h2>

    <h3>関連ファイル</h3>
    <ul>
        <li><strong>型定義</strong>: <code>src/types/index.ts</code></li>
        <li><strong>アイテムフォーム</strong>: <code>src/pages/items/ItemForm.tsx</code></li>
        <li><strong>生地フォーム</strong>: <code>src/pages/fabrics/FabricForm.tsx</code></li>
        <li><strong>型紙フォーム</strong>: <code>src/pages/patterns/PatternForm.tsx</code></li>
    </ul>

    <h3>現在のデータ構造</h3>
    <pre><code>アイテム (Item)
├── fabricNo: string (文字列)  ← 生地マスタと未連動
├── composition: string        ← 生地と重複
├── patternId: string          ← 型紙マスタと部分連動
└── patternNo: string

生地 (Fabric)
├── fabricCode: string
├── fabricName: string
├── composition: string        ← アイテムと重複
└── ...

型紙 (Pattern)
├── patternCode: string
├── patternName: string
└── ...</code></pre>

    <hr>

    <blockquote>
        <strong>備考:</strong><br>
        このドキュメントは今後の改善検討用の資料です。<br>
        実装時期や優先順位は、運用状況と照らし合わせて管理者にて判断してください。
    </blockquote>

    <hr>

    <p style="text-align: center; color: #64748b; margin-top: 40px;">
        <strong>作成者</strong>: Claude (AI Assistant)<br>
        <strong>最終更新</strong>: 2025年11月2日
    </p>
</body>
</html>
